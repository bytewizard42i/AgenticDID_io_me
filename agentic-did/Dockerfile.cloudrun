# AgenticDID.io Cloud Run Dockerfile
# Production deployment with frontend + backend in one service

FROM oven/bun:1.2.22

WORKDIR /app

# Copy everything (workspace packages need to be present for install)
COPY . .

# Install all dependencies (including workspace packages)
RUN bun install

# Build the frontend
RUN cd apps/web && bun run build

# Cloud Run uses PORT environment variable
ENV PORT=8080
ENV NODE_ENV=production
EXPOSE 8080

# Run production server (serves both frontend and API)
CMD ["bun", "run", "apps/verifier-api/src/index.production.ts"]
